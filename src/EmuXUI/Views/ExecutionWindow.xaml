<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="EmuXUI.Views.ExecutionWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:EmuXUI.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ObservableModels="using:EmuXUI.Models.Observable"
    xmlns:StaticModels="using:EmuXUI.Models.Static"
    mc:Ignorable="d"
    Activated="Window_Activated"
    Title="ExecutionWindow">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid x:Name = "mainGrid" Background = "{StaticResource Grey900}">
        <Grid.RowDefinitions>
            <RowDefinition Height = "Auto" />
            <RowDefinition Height = "*" />
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width = "*" />
        </Grid.ColumnDefinitions>

        <Grid x:Name = "TitleBarGrid" Grid.Row = "0" Grid.Column = "0" Background = "{StaticResource Grey950}">
            <Grid.RowDefinitions>
                <RowDefinition Height = "*" />
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width = "*" />
            </Grid.ColumnDefinitions>

            <Grid Grid.Row = "0" Grid.Column = "0" Margin = "10,10,10,10">
                <Grid.RowDefinitions>
                    <RowDefinition Height = "*" />
                </Grid.RowDefinitions>

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width = "*" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Row = "0" Grid.Column = "0" HorizontalAlignment = "Center" FontSize = "16" Text = "EmuX - Code Execution" />
            </Grid>
        </Grid>

        <Grid Grid.Row = "1" Grid.Column = "0" Padding = "10,10,10,10" RowSpacing = "10" ColumnSpacing = "10">
            <Grid.RowDefinitions>
                <RowDefinition Height = "*" />
                <RowDefinition Height = "*" />
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width = "*" />
                <ColumnDefinition Width = "Auto" />
            </Grid.ColumnDefinitions>

            <ListView Grid.Row = "0" Grid.Column = "0" IsHitTestVisible = "False" ItemsSource = "{x:Bind ViewModel.SourceCodeLines, Mode = OneWay}" SelectedIndex = "{x:Bind ViewModel.NextInstructionIndex, Mode = OneWay}">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType = "StaticModels:SourceCodeLine">
                        <Grid ColumnSpacing = "6">
                            <Grid.RowDefinitions>
                                <RowDefinition Height = "*" />
                            </Grid.RowDefinitions>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width = "10px" />
                                <ColumnDefinition Width = "*" />
                            </Grid.ColumnDefinitions>
                            
                            <Frame Grid.Row = "0" Grid.Column = "0" Height = "10" Width = "10" CornerRadius = "100" Background = "Red" Visibility = "{x:Bind Breakpoint}" />
                            <TextBlock Grid.Row = "0" Grid.Column = "1" Text = "{x:Bind SourceCode}" />
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <StackPanel Grid.Row = "0" Grid.Column = "1" Orientation = "Vertical" Spacing = "10">
                <Button x:Name = "ButtonExecute" Content = "Execute" HorizontalAlignment = "Stretch" Command = "{x:Bind ViewModel.CommandExecuteCode, Mode = OneTime}" />
                <Button Content = "Step" HorizontalAlignment = "Stretch" Command = "{x:Bind ViewModel.CommandStepToNextInstruction, Mode = OneTime}" />
                <Button Content = "Step Over" HorizontalAlignment = "Stretch" Command = "{x:Bind ViewModel.CommandStepOver, Mode = OneTime}" />
                <Button Content = "Undo" HorizontalAlignment = "Stretch" Command = "{x:Bind ViewModel.CommandUndoInstruction, Mode = OneTime}" />
                <Button Content = "Redo" HorizontalAlignment = "Stretch" Command = "{x:Bind ViewModel.CommandRedoInstruction, Mode = OneTime}" />
                <Button Content = "Reset" HorizontalAlignment = "Stretch" Command = "{x:Bind ViewModel.CommandResetInstruction, Mode = OneTime}" />
            </StackPanel>

            <TabView Grid.Row = "1" Grid.Column = "0" Grid.ColumnSpan = "2" VerticalAlignment = "Stretch" IsAddTabButtonVisible = "False" CanDragTabs = "False" CanReorderTabs = "False">
                <TabViewItem Header = "Video" IsClosable = "False">
                    <Grid VerticalAlignment = "Top" HorizontalAlignment = "Left" ColumnSpacing = "10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height = "*" />
                        </Grid.RowDefinitions>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width = "Auto" />
                            <ColumnDefinition Width = "*" />
                        </Grid.ColumnDefinitions>

                        <Image Grid.Row = "0" Grid.Column = "0" VerticalAlignment = "Top" HorizontalAlignment = "Left" Height = "{x:Bind ViewModel.VideoOutput.Height, Mode = OneTime}" Width = "{x:Bind ViewModel.VideoOutput.Height, Mode = OneTime}" Source = "{x:Bind ViewModel.VideoOutput.Image, Mode = OneWay}" />

                        <StackPanel Grid.Row = "0" Grid.Column = "1" Margin = "0,10,0,0" Orientation = "Vertical" Spacing = "10">
                            <StackPanel Orientation = "Horizontal" Spacing = "0">
                                <TextBlock Margin = "0,0,10,0" Text = "Height:" FontWeight = "Bold" />
                                <TextBlock Text = "{x:Bind ViewModel.VideoOutput.Height, Mode = OneTime}" />
                                <TextBlock Text = "px" FontWeight = "Bold" />
                            </StackPanel>

                            <StackPanel Orientation = "Horizontal" Spacing = "0">
                                <TextBlock Margin = "0,0,10,0" Text = "Width:" FontWeight = "Bold" />
                                <TextBlock Text = "{x:Bind ViewModel.VideoOutput.Width, Mode = OneTime}" />
                                <TextBlock Text = "px" FontWeight = "Bold" />
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </TabViewItem>

                <TabViewItem Header = "Memory" IsClosable = "False" VerticalAlignment = "Stretch">
                    <Grid Margin = "10" VerticalAlignment = "Stretch">
                        <Grid.RowDefinitions>
                            <RowDefinition Height = "*" />
                        </Grid.RowDefinitions>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width = "*" />
                            <ColumnDefinition Width = "*" />
                        </Grid.ColumnDefinitions>

                        <ListBox x:Name = "ListBoxSearchedMemoryBytes" Grid.Row = "0" Grid.Column = "0" ItemsSource = "{x:Bind ViewModel.SearchedBytes, Mode = OneWay}" CharacterSpacing="0">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType = "ListBoxItem">
                                    <Setter Property = "HorizontalContentAlignment" Value = "Stretch" />
                                </Style>
                            </ListBox.ItemContainerStyle>
                            
                            <ListBox.ItemTemplate>
                                <DataTemplate x:DataType = "ObservableModels:MemoryByte">
                                    <Grid HorizontalAlignment = "Stretch" ColumnSpacing = "10">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height = "*" />
                                        </Grid.RowDefinitions>

                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width = "30*" />
                                            <ColumnDefinition Width = "70*" />
                                        </Grid.ColumnDefinitions>
                                        
                                        <TextBlock Grid.Row = "0" Grid.Column = "0" VerticalAlignment = "Center" Text = "{x:Bind Index, Mode = OneTime}" />
                                        <NumberBox Grid.Row = "0" Grid.Column = "1" Minimum = "0" Maximum = "255" Value = "{x:Bind Value, Mode = TwoWay}" />
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <StackPanel Grid.Row = "0" Grid.Column = "1" Margin = "10" Spacing = "10">
                            <Frame Padding = "10" Background = "{StaticResource Grey850}" CornerRadius = "10">
                                <StackPanel Spacing = "4">
                                    <StackPanel Orientation = "Horizontal" Spacing = "4">
                                        <TextBlock Text = "IO Memory:" />
                                        <TextBlock Text = "{x:Bind ViewModel.IOMemory, Mode = OneTime}" FontWeight = "Bold" />
                                        <TextBlock Text = "bytes" />
                                    </StackPanel>

                                    <StackPanel Spacing = "10">
                                        <StackPanel Orientation = "Horizontal" Spacing = "4">
                                            <TextBlock Text = "GP memory:" />
                                            <TextBlock Text = "{x:Bind ViewModel.GeneralPurposeMemory, Mode = OneTime}" FontWeight = "Bold" />
                                            <TextBlock Text = "bytes" />
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>
                            </Frame>

                            <Frame Background = "{StaticResource Grey850}" CornerRadius = "10">
                                <Grid RowSpacing = "10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height = "Auto" />
                                        <RowDefinition Height = "Auto" />
                                        <RowDefinition Height = "Auto" />
                                    </Grid.RowDefinitions>

                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width = "30*" />
                                        <ColumnDefinition Width = "70*" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row = "0" Grid.Column = "0" Margin = "10,0,0,0" VerticalAlignment = "Center" Text = "Start" />
                                    <NumberBox Grid.Row = "0" Grid.Column = "1" Minimum = "0" Value = "{x:Bind ViewModel.StartMemorySearchIndex, Mode = TwoWay}" />

                                    <TextBlock Grid.Row = "1" Grid.Column = "0" Margin = "10,0,0,0" VerticalAlignment = "Center" Text = "Bytes" />
                                    <NumberBox Grid.Row = "1" Grid.Column = "1" Minimum = "0" Value = "{x:Bind ViewModel.MemorySearchBytesToGet, Mode = TwoWay}" />

                                    <Button Grid.Row = "2" Grid.Column = "0" Grid.ColumnSpan = "2" HorizontalAlignment = "Stretch" Content = "Search" Command = "{x:Bind ViewModel.CommandSearchMemory, Mode =OneTime}" />
                                </Grid>
                            </Frame>
                        </StackPanel>
                    </Grid>
                </TabViewItem>

                <TabViewItem Header = "Registers" IsClosable = "False" VerticalAlignment = "Stretch">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height = "*" />
                        </Grid.RowDefinitions>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width = "*" />
                        </Grid.ColumnDefinitions>

                        <ListBox Grid.Row = "0" Grid.Column = "0" ItemsSource = "{x:Bind ViewModel.Registers, Mode = OneTime}">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType = "ListBoxItem">
                                    <Setter Property = "HorizontalContentAlignment" Value = "Stretch" />
                                </Style>
                            </ListBox.ItemContainerStyle>
                            
                            <ListBox.ItemTemplate>
                                <DataTemplate x:DataType = "ObservableModels:Register">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height = "*" />
                                        </Grid.RowDefinitions>

                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width = "30*" />
                                            <ColumnDefinition Width = "70*" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Row = "0" Grid.Column = "0" VerticalAlignment = "Center" Text = "{x:Bind Name, Mode = OneTime}" />
                                        <NumberBox Grid.Row = "0" Grid.Column = "1" Minimum = "0" Maximum = "{x:Bind MaximumValue}" Value = "{x:Bind Value, Mode = TwoWay}" />
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </TabViewItem>
            </TabView>
        </Grid>
    </Grid>
    
</Window>
